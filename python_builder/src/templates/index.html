<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
        {{ css_content }}
    </style>
</head>
<body>
    
    <!-- Desktop Environment -->
    <div class="desktop-container">
        
        <!-- Top Navigation Bar -->
        <nav class="top-nav">
            <div class="nav-left">
                <div class="nav-brand">
                    <div class="logo-hexagon"></div>
                    <span class="brand-text" title="Uncharted fingerprints of human misspelling behavior">Spell Atlas</span>
                </div>
                <div class="nav-divider"></div>
                <div class="nav-menu">
                    <button class="nav-item active" data-action="reset-view" title="Reset Map View">
                        <span class="icon material-icons-round">public</span> OVERVIEW
                    </button>
                    <button class="nav-item" data-action="toggle-feed" title="Live Data Stream">
                        <span class="icon material-icons-round">waves</span> FEED
                    </button>
                    <button class="nav-item" data-action="toggle-analysis" title="Toggle Analysis Tools">
                        <span class="icon material-icons-round">warning</span> THREATS
                    </button>
                    <button class="nav-item" data-action="toggle-countries" title="Country Statistics">
                        <span class="icon material-icons-round">pie_chart</span> COUNTRIES
                    </button>
                    <button class="nav-item" data-action="toggle-timeline" title="Timeline Analysis">
                        <span class="icon material-icons-round">history</span> TIMELINE
                    </button>
                </div>
            </div>

            <div class="nav-right">
                <div class="sys-stat">
                    <span class="label">CPU</span>
                    <div class="bar-graph"><div class="fill" style="width: 45%"></div></div>
                </div>
                <div class="sys-stat">
                    <span class="label">MEM</span>
                    <div class="bar-graph"><div class="fill" style="width: 62%"></div></div>
                </div>
                <div class="nav-divider"></div>
                <div class="nav-clock" id="system-clock">00:00:00 UTC</div>
            </div>
        </nav>

        <!-- Main Content Area (Map as Wallpaper/Base) -->
        <main class="main-viewport">
            <div id="map"></div>
            <div class="scanline-overlay"></div>
            <div class="vignette-overlay"></div>
            <div class="grid-overlay"></div>
            
            <!-- Floating Windows Area -->
            <div class="window-layer">
                <!-- Live Feed Window -->
                <div id="win-feed" class="glass-window" data-title="LIVE FEED" style="left: 16px; top: 88px; width: 320px; height: 450px;">
                    <div class="window-header">
                        <div class="win-title-group">
                            <span class="win-icon material-icons-round">waves</span>
                            <span class="win-title">DATA STREAM</span>
                        </div>
                        <div class="win-controls">
                            <button class="win-btn minimize" title="Minimize"><span class="material-icons-round">remove</span></button>
                            <button class="win-btn maximize" title="Maximize"><span class="material-icons-round">crop_square</span></button>
                        </div>
                    </div>
                    <div class="window-body scrollbar-tech" id="feed-content">
                        <!-- Feed Items -->
                    </div>
                    <div class="window-footer">
                        <span class="status-light online"></span> RECEIVING
                    </div>
                </div>

                <!-- Threat Analysis Window -->
                <div id="win-threats" class="glass-window warning-theme" data-title="THREATS" style="right: 16px; top: 80px; width: 340px; height: auto; max-height: 400px;">
                    <div class="window-header">
                        <div class="win-title-group">
                            <span class="win-icon material-icons-round">warning</span>
                            <span class="win-title">ACTIVE ANOMALIES</span>
                        </div>
                        <div class="win-controls">
                            <button class="win-btn minimize"><span class="material-icons-round">remove</span></button>
                        </div>
                    </div>
                    <div class="window-body scrollbar-tech" id="threats-content">
                        <div class="empty-state">SYSTEM SECURE. NO ACTIVE THREATS.</div>
                    </div>
                </div>

                <!-- Country Statistics Window -->
                <div id="win-countries" class="glass-window" data-title="COUNTRY_STATS" style="left: 16px; bottom: 16px; top: auto; width: 380px; height: 400px; display: none;">
                    <div class="window-header">
                        <div class="win-title-group">
                            <span class="win-icon material-icons-round">public</span>
                            <span class="win-title">UNESCO ANALYSIS</span>
                        </div>
                        <div class="win-controls">
                            <button class="win-btn minimize"><span class="material-icons-round">remove</span></button>
                            <button class="win-btn maximize" title="Maximize"><span class="material-icons-round">crop_square</span></button>
                        </div>
                    </div>
                    <div class="window-body scrollbar-tech" id="countries-content">
                        <div class="country-stats-header">
                            <div class="stat-item">
                                <span class="stat-label">TOTAL COUNTRIES</span>
                                <span class="stat-value" id="total-countries">194</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ACTIVE REGIONS</span>
                                <span class="stat-value" id="active-regions">5</span>
                            </div>
                        </div>
                        <div class="region-filters">
                            <button class="filter-btn active" data-region="all">ALL</button>
                            <button class="filter-btn" data-region="Africa">AFRICA</button>
                            <button class="filter-btn" data-region="Americas">AMERICAS</button>
                            <button class="filter-btn" data-region="Asia">ASIA</button>
                            <button class="filter-btn" data-region="Europe">EUROPE</button>
                            <button class="filter-btn" data-region="Oceania">OCEANIA</button>
                        </div>
                        <div class="country-list" id="country-list">
                            <!-- Country statistics will be populated here -->
                        </div>
                    </div>
                    <div class="window-footer">
                        <span class="status-light online"></span> UNESCO DATA STREAM
                    </div>
                </div>

                <!-- Timeline Analysis Window -->
                <div id="win-timeline" class="glass-window timeline-window" data-title="TIMELINE" style="right: 20px; top: 80px; width: 700px; height: 400px; display: none;">
                    <div class="window-header">
                        <div class="win-title-group">
                            <span class="win-icon material-icons-round">history</span>
                            <span class="win-title">TIMELINE ANALYSIS</span>
                        </div>
                        <div class="win-controls">
                            <button class="win-btn minimize" title="Minimize"><span class="material-icons-round">remove</span></button>
                            <button class="win-btn maximize" title="Maximize"><span class="material-icons-round">crop_square</span></button>
                        </div>
                    </div>
                    <div class="window-body">
                        <div class="timeline-controls">
                            <div class="timeline-playback">
                                <button id="btn-timeline-prev" class="timeline-btn" title="Previous Day">
                                    <span class="material-icons-round">skip_previous</span>
                                </button>
                                <button id="btn-timeline-play" class="timeline-btn" title="Play/Pause">
                                    <span class="material-icons-round">play_arrow</span>
                                </button>
                                <button id="btn-timeline-next" class="timeline-btn" title="Next Day">
                                    <span class="material-icons-round">skip_next</span>
                                </button>
                            </div>
                            <input type="range" id="timeline-slider" class="timeline-slider" min="0" max="29" value="0">
                            <div class="timeline-speed">
                                <span class="speed-label">SPEED</span>
                                <div class="speed-control">
                                    <button id="btn-timeline-slower" class="speed-btn" title="Slower"><span class="material-icons-round">remove</span></button>
                                    <span class="speed-display" id="timeline-speed-display">1.0x</span>
                                    <button id="btn-timeline-faster" class="speed-btn" title="Faster"><span class="material-icons-round">add</span></button>
                                </div>
                            </div>
                        </div>
                        <div class="timeline-chart">
                            <canvas id="timeline-canvas" class="timeline-canvas" width="680" height="280"></canvas>
                            <div class="timeline-info">
                                <div class="timeline-day">Day 0</div>
                                <div class="timeline-stats">
                                    <div class="timeline-stat">
                                        <span class="stat-label">Total Events</span>
                                        <span class="stat-value" id="timeline-total">0</span>
                                    </div>
                                    <div class="timeline-stat">
                                        <span class="stat-label">Error Rate</span>
                                        <span class="stat-value" id="timeline-error-rate">0%</span>
                                    </div>
                                    <div class="timeline-stat">
                                        <span class="stat-label">Countries</span>
                                        <span class="stat-value" id="timeline-countries">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="window-footer">
                        <span class="status-light online"></span> TIMELINE ACTIVE
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Global Status Bar -->
        <footer class="status-bar">
            <!-- Start Menu / Dashboard -->
            <div class="status-section left">
                <button class="start-btn" title="System Menu">
                    <span class="material-icons-round">apps</span>
                </button>
                <div class="status-divider"></div>
                <!-- Taskbar Area (Open Windows) -->
                <div class="taskbar-dock" id="taskbar">
                    <!-- Tasks injected by JS -->
                </div>
            </div>

            <!-- Dynamic Notification Area (Auto-Sensing) -->
            <div class="status-section center">
                <div class="dynamic-island" id="dynamic-island">
                    <div class="island-content">
                        <span class="island-icon material-icons-round">info</span>
                        <span class="island-message">SYSTEM READY</span>
                    </div>
                </div>
            </div>

            <!-- Global Controls & Stats -->
            <div class="status-section right">
                <!-- Mini Player -->
                <div class="control-cluster">
                    <button id="btn-slower" class="ctrl-btn" title="Decelerate"><span class="material-icons-round">remove</span></button>
                    <button id="btn-pause" class="ctrl-btn main" title="Pause/Resume"><span class="material-icons-round">pause</span></button>
                    <button id="btn-faster" class="ctrl-btn" title="Accelerate"><span class="material-icons-round">add</span></button>
                    <div class="speed-indicator">
                        <span class="label">SPEED</span>
                        <span class="value" id="speed-val">1.0x</span>
                    </div>
                </div>
                
                <div class="status-divider"></div>
                
                <!-- Network Stats -->
                <div class="stat-cluster">
                    <div class="stat-row">
                        <span class="label">LATENCY</span>
                        <span class="val text-green">12ms</span>
                    </div>
                    <div class="stat-row">
                        <span class="label">PACKETS</span>
                        <span class="val" id="stat-total">0</span>
                    </div>
                </div>
                
                <div class="stat-cluster alert-cluster">
                    <div class="stat-row">
                        <span class="label">ERRORS</span>
                        <span class="val text-alert" id="stat-errors">0</span>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        {{ js_content }}
    </script>
</body>
</html>